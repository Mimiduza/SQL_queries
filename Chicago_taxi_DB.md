## Структура БД
![DB_scheme](/assets/Chicago_taxi_DB.png?raw=true "Структура БД")

<details> 
  <summary>Описание содержимого таблиц</summary>
  Таблица neighborhoods — информация о районах города:

- neighborhood_id — код района
- name — название района

Таблица cabs — информация о такси:
- cab_id — идентификатор такси
- vehicle_id — уникальный идентификатор автомобиля
- company_name — компания, которой принадлежит автомобиль

Таблица trips — информация о поездках:
- trip_id — код поездки
- cab_id — идентификатор такси, на котором была совершена поездка
- start_ts — дата и время начала поездки (время округлено до часа)
- end_ts — дата и время окончания поездки (время округлено до часа)
- duration_seconds — длительность поездки в секундах
- distance_miles — дальность поездки в милях
- pickup_location_id — код района города, в котором была начата поездка
- dropoff_location_id — код района города, в котором завершилась поездка

Таблица weather_records — информация о погоде:
- record_id — код записи погодных наблюдений
- ts — дата и время наблюдения (время округлено до часа)
- temperature — температура на момент наблюдения
- description — краткое описание погодных условий. Например, light rain или scattered clouds

</details>

## Задача 1
По плану на линию обслуживания должно было выйти 10550 автомобилей — эта цифра покрывает спрос пользователей. Команде поступило много жалоб: свободных автомобилей оказалось недостаточно. Сколько такси вышло на линии на самом деле? Один автомобиль может принадлежать нескольким компаниям.

```SQL
SELECT 
COUNT(DISTINCT vehicle_id) 
FROM cabs;
```

## Задача 2
Команда предполагает, что некоторые компании не вывели достаточно автомобилей на линию. Нужно посчитать количество автомобилей в каждой компании и вывести те, в которых меньше 100 автомобилей. Отсортировать значения по убыванию.  

```SQL
SELECT 
company_name, 
COUNT(cab_id) AS cnt 
FROM cabs 
GROUP BY company_name 
HAVING COUNT(cab_id) < 100 
ORDER BY cnt DESC;
```

## Задача 3
В приложении такси рассчитывается коэффициент стоимости поездки. Если погода хорошая, значение коэффициента равно 1. Если на улице дождь или шторм, коэффициент повышается до 2. У команды есть гипотеза, что в расчётах коэффициента ошибка. Нужно получить информацию о состоянии погоды на каждый час за период с 2017-11-05 00:00 по 2017-11-06 00:00, чтобы разработчик сверил коэффициент с данными в логах и исправил баг.

```SQL
SELECT 
ts,
CASE WHEN description LIKE '%rain%' THEN 'Bad weather' 
WHEN description LIKE '%storm%' THEN 'Bad' 
ELSE 'Good weather' END AS weather_conditions 
FROM weather_records 
WHERE ts >= '2017-11-05 00:00:00' AND ts < '2017-11-06 00:00:00';
```

## Задача 4
После обновления ПО таксопарки стали сообщать, что прибыль, которую они получают, не сходится с данными, которые отдаёт приложение. Разработка предполагает, что проблема может быть в данных о количестве поездок.
Чтобы определить, есть ли баг, нужно получить выборку с количеством поездок каждого таксопарка за 15 и 16 ноября 2017 года.

```SQL
SELECT 
cabs.company_name, 
COUNT(trips.trip_id) AS trips_amount 
FROM trips 
JOIN cabs ON trips.cab_id = cabs.cab_id 
WHERE trips.start_ts >= '2017-11-15 00:00:00' AND trips.start_ts < '2017-11-17 00:00:00' 
GROUP BY cabs.company_name 
ORDER BY trips_amount DESC;
```